(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/users/user_address/index"],{"741c":function(t,i,e){},"8afb":function(t,i,e){"use strict";var n=e("741c"),s=e.n(n);s.a},"97d8":function(t,i,e){"use strict";(function(t){Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var n=e("cc12"),s=e("a30d"),r=e("8a48"),a=e("26cb"),c=e("1e98"),d=function(){Promise.all([e.e("common/vendor"),e.e("components/Authorize")]).then(function(){return resolve(e("5da7"))}.bind(null,e)).catch(e.oe)},o=function(){e.e("components/home/index").then(function(){return resolve(e("40e3"))}.bind(null,e)).catch(e.oe)},u=getApp(),l={components:{authorize:d,home:o},data:function(){return{cartId:"",pinkId:0,couponId:0,id:0,userAddress:{isDefault:!1},region:["省","市","区"],valueRegion:[0,0,0],isAuto:!1,isShowAuth:!1,district:[],multiArray:[],multiIndex:[0,0,0],cityId:0,bargain:!1,combination:!1,secKill:!1,theme:u.globalData.theme}},computed:(0,a.mapGetters)(["isLogin"]),watch:{isLogin:{handler:function(t,i){t&&(this.getUserAddress(),this.getCityList())},deep:!0}},onLoad:function(i){var e=this;this.isLogin?(this.preOrderNo=i.preOrderNo||0,this.id=i.id||0,t.setNavigationBarTitle({title:i.id?"修改地址":"添加地址"}),this.getUserAddress(),this.$Cache.getItem("cityList")?(this.district=this.$Cache.getItem("cityList"),setTimeout((function(t){e.initialize()}),1e3)):this.getCityList()):(0,r.toLogin)()},methods:{getCityList:function(){var t=this,i=this;(0,s.getCity)().then((function(e){t.district=e.data;var n=864e5;t.$Cache.setItem({name:"cityList",value:e.data,expires:7*n}),i.initialize()}))},getUserAddress:function(){if(!this.id)return!1;var t=this;(0,n.getAddressDetail)(this.id).then((function(i){var e=[i.data.province,i.data.city,i.data.district];t.$set(t,"userAddress",i.data),t.$set(t,"region",e),t.city_id=i.data.cityId}))},initialize:function(){var t=this,i=[],e=[],n=[];if(t.district.length){var s=t.district[0].child||[];s.length&&s[0].child;t.district.forEach((function(e,n){i.push(e.name),e.name===t.region[0]&&(t.valueRegion[0]=n,t.multiIndex[0]=n)})),t.district[this.valueRegion[0]].child.forEach((function(i,n){e.push(i.name),t.region[1]==i.name&&(t.valueRegion[1]=n,t.multiIndex[1]=n)})),t.district[this.valueRegion[0]].child[this.valueRegion[1]].child.forEach((function(i,e){n.push(i.name),t.region[2]==i.name&&(t.valueRegion[2]=e,t.multiIndex[2]=e)})),this.multiArray=[i,e,n]}},bindRegionChange:function(t){var i=this.multiIndex,e=this.district[i[0]]||{child:[]},n=e.child[i[1]]||{cityId:0},s=this.multiArray,r=t.detail.value;this.region=[s[0][r[0]],s[1][r[1]],s[2][r[2]]],this.cityId=n.cityId,this.valueRegion=[0,0,0],this.initialize()},bindMultiPickerColumnChange:function(t){var i=this,e=t.detail.column,n=t.detail.value,s=this.district[n]||{child:[]},r=i.multiArray,a=i.multiIndex;switch(a[e]=n,e){case 0:var c=s.child[0]||{child:[]};r[1]=s.child.map((function(t){return t.name})),r[2]=c.child.map((function(t){return t.name}));break;case 1:var d=i.district[a[0]].child[a[1]].child||[];r[2]=d.map((function(t){return t.name}));break;case 2:break}this.$set(this.multiArray,0,r[0]),this.$set(this.multiArray,1,r[1]),this.$set(this.multiArray,2,r[2]),this.multiIndex=a},onLoadFun:function(){this.getUserAddress()},authColse:function(t){this.isShowAuth=t},toggleTab:function(t){this.$refs[t].show()},onConfirm:function(t){this.region=t.checkArr[0]+"-"+t.checkArr[1]+"-"+t.checkArr[2]},chooseLocation:function(){var i=this;t.chooseLocation({success:function(t){i.$set(i.userAddress,"detail",t.address.replace(/.+?(省|市|自治区|自治州|县|区)/g,""))}})},getWxAddress:function(){var i=this;t.authorize({scope:"scope.address",success:function(e){t.chooseAddress({success:function(e){var s={};s.province=e.provinceName,s.city=e.cityName,s.district=e.countyName,s.cityId=0,(0,n.editAddress)({address:s,isDefault:1,realName:e.userName,postCode:e.postalCode,phone:e.telNumber,detail:e.detailInfo,id:0}).then((function(e){return setTimeout((function(){if(i.cartId){var n=i.cartId,s=i.pinkId,r=i.couponId;i.cartId="",i.pinkId="",i.couponId="",t.navigateTo({url:"/pages/users/order_confirm/index?cartId="+n+"&addressId="+(i.id?i.id:e.data.id)+"&pinkId="+s+"&couponId="+r+"&secKill="+i.secKill+"&combination="+i.combination+"&bargain="+i.bargain})}else t.navigateBack({delta:1})}),1e3),i.$util.Tips({title:"添加成功",icon:"success"})})).catch((function(t){return i.$util.Tips({title:t})}))},fail:function(t){if("chooseAddress:cancel"==t.errMsg)return i.$util.Tips({title:"取消选择"})}})},fail:function(e){t.showModal({title:"您已拒绝导入微信地址权限",content:"是否进入权限管理，调整授权？",success:function(e){if(e.confirm)t.openSetting({success:function(t){}});else if(e.cancel)return i.$util.Tips({title:"已取消！"})}})}})},getAddress:function(){var i=this,e=this;e.$wechat.openAddress().then((function(s){(0,n.editAddress)({id:i.id,realName:s.userName,phone:s.telNumber,address:{province:s.provinceName,city:s.cityName,district:s.countryName,cityId:0},detail:s.detailInfo,isDefault:1,postCode:s.postalCode}).then((function(){setTimeout((function(){if(e.cartId){var i=e.cartId,n=e.pinkId,s=e.couponId;e.cartId="",e.pinkId="",e.couponId="",t.navigateTo({url:"/pages/users/order_confirm/index?cartId="+i+"&addressId="+(e.id?e.id:res.data.id)+"&pinkId="+n+"&couponId="+s+"&secKill="+e.secKill+"&combination="+e.combination+"&bargain="+e.bargain})}else t.navigateTo({url:"/pages/users/user_address_list/index"})}),1e3),e.$util.Tips({title:"添加成功",icon:"success"})})).catch((function(t){return e.$util.Tips({title:t||"添加失败"})}))})).catch((function(t){console.log(t)}))},formSubmit:(0,c.Debounce)((function(i){var e=this,s=i.detail.value;if(!s.realName)return e.$util.Tips({title:"请填写收货人姓名"});if(!s.phone)return e.$util.Tips({title:"请填写联系电话"});if(!/^1(3|4|5|7|8|9|6)\d{9}$/i.test(s.phone))return e.$util.Tips({title:"请输入正确的手机号码"});if("省-市-区"==e.region)return e.$util.Tips({title:"请选择所在地区"});if(!s.detail)return e.$util.Tips({title:"请填写详细地址"});s.id=e.id;var r=e.region;s.address={province:r[0],city:r[1],district:r[2],cityId:e.cityId},s.isDefault=e.userAddress.isDefault,t.showLoading({title:"保存中",mask:!0}),(0,n.editAddress)(s).then((function(i){e.id?e.$util.Tips({title:"修改成功",icon:"success"}):e.$util.Tips({title:"添加成功",icon:"success"}),setTimeout((function(){if(!(e.preOrderNo>0))return t.navigateBack({delta:1});t.redirectTo({url:"/pages/users/order_confirm/index?preOrderNo="+e.preOrderNo+"&addressId="+(e.id?e.id:i.data.id)})}),1e3)})).catch((function(t){return e.$util.Tips({title:t})}))})),ChangeIsDefault:function(t){this.$set(this.userAddress,"isDefault",!this.userAddress.isDefault)}}};i.default=l}).call(this,e("543d")["default"])},d8a5:function(t,i,e){"use strict";e.r(i);var n=e("97d8"),s=e.n(n);for(var r in n)"default"!==r&&function(t){e.d(i,t,(function(){return n[t]}))}(r);i["default"]=s.a},de11:function(t,i,e){"use strict";var n;e.d(i,"b",(function(){return s})),e.d(i,"c",(function(){return r})),e.d(i,"a",(function(){return n}));var s=function(){var t=this,i=t.$createElement;t._self._c},r=[]},f257:function(t,i,e){"use strict";e.r(i);var n=e("de11"),s=e("d8a5");for(var r in s)"default"!==r&&function(t){e.d(i,t,(function(){return s[t]}))}(r);e("8afb");var a,c=e("f0c5"),d=Object(c["a"])(s["default"],n["b"],n["c"],!1,null,"20294c84",null,!1,n["a"],a);i["default"]=d.exports},fd21:function(t,i,e){"use strict";(function(t){e("f524");n(e("66fd"));var i=n(e("f257"));function n(t){return t&&t.__esModule?t:{default:t}}wx.__webpack_require_UNI_MP_PLUGIN__=e,t(i.default)}).call(this,e("543d")["createPage"])}},[["fd21","common/runtime","common/vendor"]]]);