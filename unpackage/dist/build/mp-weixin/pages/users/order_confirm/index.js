(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/users/order_confirm/index"],{"12a2":function(e,t,n){},"14d9":function(e,t,n){"use strict";(function(e){n("f524");r(n("66fd"));var t=r(n("34e0"));function r(e){return e&&e.__esModule?e:{default:e}}wx.__webpack_require_UNI_MP_PLUGIN__=n,e(t.default)}).call(this,n("543d")["createPage"])},"34e0":function(e,t,n){"use strict";n.r(t);var r=n("5e33"),i=n("9e33");for(var s in i)"default"!==s&&function(e){n.d(t,e,(function(){return i[e]}))}(s);n("88bc");var o,a=n("f0c5"),d=Object(a["a"])(i["default"],r["b"],r["c"],!1,null,"b8a5e832",null,!1,r["a"],o);t["default"]=d.exports},"5e33":function(e,t,n){"use strict";var r;n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return s})),n.d(t,"a",(function(){return r}));var i=function(){var e=this,t=e.$createElement,n=(e._self._c,0==e.shippingType?parseFloat(e.orderInfoVo.freightFee):null);e.$mp.data=Object.assign({},{$root:{m0:n}})},s=[]},8431:function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n("fa41"),i=n("cc12"),s=n("be59"),o=n("b07f"),a=(n("5355"),n("8a48")),d=n("26cb");n("1e98");function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var p=function(){Promise.all([n.e("common/vendor"),n.e("components/couponListWindow/index")]).then(function(){return resolve(n("a48c"))}.bind(null,n)).catch(n.oe)},f=function(){n.e("components/addressWindow/index").then(function(){return resolve(n("6bc5"))}.bind(null,n)).catch(n.oe)},h=function(){n.e("components/orderGoods/index").then(function(){return resolve(n("eedd"))}.bind(null,n)).catch(n.oe)},g=function(){n.e("components/home/index").then(function(){return resolve(n("40e3"))}.bind(null,n)).catch(n.oe)},y=function(){Promise.all([n.e("common/vendor"),n.e("components/Authorize")]).then(function(){return resolve(n("5da7"))}.bind(null,n)).catch(n.oe)},m=getApp(),I={components:{couponListWindow:p,addressWindow:f,orderGoods:h,home:g,authorize:y},data:function(){return{orderShow:"orderShow",textareaStatus:!0,cartArr:[{name:"微信支付",icon:"icon-weixin2",value:"weixin",title:"微信快捷支付",payStatus:1},{name:"余额支付",icon:"icon-yuezhifu",value:"yue",title:"可用余额:",payStatus:1}],payType:"weixin",openType:1,active:0,coupon:{coupon:!1,list:[],statusTile:"立即使用"},address:{address:!1,addressId:0},addressInfo:{},addressId:0,couponId:0,cartId:"",userInfo:{},mark:"",couponTitle:"请选择",coupon_price:0,useIntegral:!1,integral_price:0,integral:0,ChangePrice:0,formIds:[],status:0,is_address:!1,toPay:!1,shippingType:0,system_store:{},storePostage:0,contacts:"",contactsTel:"",mydata:{},storeList:[],store_self_mention:0,cartInfo:[],priceGroup:{},animated:!1,totalPrice:0,integralRatio:"0",pagesUrl:"",orderKey:"",offlinePostage:"",isAuto:!1,isShowAuth:!1,payChannel:"",news:!0,again:!1,addAgain:!1,bargain:!1,combination:!1,secKill:!1,orderInfoVo:{},addressList:[],orderProNum:0,preOrderNo:"",theme:m.globalData.theme,formContent:""}},computed:c(c({},(0,d.mapGetters)(["isLogin","systemPlatform","productType"])),{},{markNum:function(){var e=0;if(this.mark)return e=150-this.mark.length,e}}),watch:{isLogin:{handler:function(e,t){e&&this.getloadPreOrder()},deep:!0}},onLoad:function(e){this.payChannel="routine",this.preOrderNo=e.preOrderNo||0,this.addressId=e.addressId||0,this.is_address=!!e.is_address,this.isLogin?this.getloadPreOrder():(0,a.toLogin)()},onShow:function(){var t=this;this.textareaStatus=!0,this.isLogin&&this.toPay,e.$on("handClick",(function(n){n&&(t.system_store=n.address),e.$off("handClick")}))},methods:{getloadPreOrder:function(){var e=this;(0,r.loadPreOrderApi)(this.preOrderNo).then((function(t){var n=t.data.orderInfoVo;e.orderInfoVo=n,e.cartInfo=n.orderDetailList,e.orderProNum=n.orderProNum,e.address.addressId=e.addressId?e.addressId:n.addressId,e.cartArr[1].title="可用余额:"+n.userBalance,e.cartArr[1].payStatus=1===parseInt(t.data.yuePayStatus)?1:2,e.cartArr[0].payStatus=1===parseInt(t.data.payWeixinOpen)?1:0,e.store_self_mention="true"==t.data.storeSelfMention&&"normal"===e.productType,e.$nextTick((function(){this.$refs.addressWindow.getAddressList()}))})).catch((function(t){return e.$util.Tips({title:t})}))},onLoadFun:function(){},getList:function(){var t=this,n=e.getStorageSync("user_longitude"),r=e.getStorageSync("user_latitude"),i={latitude:r,longitude:n,page:1,limit:10};(0,o.storeListApi)(i).then((function(e){var n=e.data.list||[];t.$set(t,"storeList",n),t.$set(t,"system_store",n[0])})).catch((function(e){return t.$util.Tips({title:e})}))},changeClose:function(){this.$set(this.address,"address",!1)},showStoreList:function(){this.storeList.length>0&&e.navigateTo({url:"/pages/users/goods_details_store/index"})},computedPrice:function(){var e=this,t=this.shippingType;(0,r.postOrderComputed)({addressId:this.address.addressId,useIntegral:!!this.useIntegral,couponId:this.couponId,shippingType:parseInt(t)+1,preOrderNo:this.preOrderNo}).then((function(t){var n=t.data;e.orderInfoVo.couponFee=n.couponFee,e.orderInfoVo.userIntegral=n.surplusIntegral,e.orderInfoVo.deductionPrice=n.deductionPrice,e.orderInfoVo.freightFee=n.freightFee,e.orderInfoVo.payFee=n.payFee,e.orderInfoVo.proTotalFee=n.proTotalFee,e.orderInfoVo.useIntegral=n.useIntegral,e.orderInfoVo.usedIntegral=n.usedIntegral,e.orderInfoVo.surplusIntegral=n.surplusIntegral})).catch((function(t){return e.$util.Tips({title:t})}))},addressType:function(e){var t=e;this.shippingType=parseInt(t),this.computedPrice(),1==t&&this.getList()},bindPickerChange:function(e){var t=e.detail.value;this.shippingType=t,this.computedPrice()},ChangCouponsClone:function(){this.$set(this.coupon,"coupon",!1)},changeTextareaStatus:function(){for(var e=0,t=this.coupon.list.length;e<t;e++)this.coupon.list[e].use_title="",this.coupon.list[e].is_use=0;this.textareaStatus=!0,this.status=0,this.$set(this.coupon,"list",this.coupon.list)},ChangCoupons:function(e){for(var t=e,n=this.coupon.list,r="请选择",i=0,s=0,o=n.length;s<o;s++)s!=t&&(n[s].use_title="",n[s].isUse=0);n[t].isUse?(n[t].use_title="",n[t].isUse=0):(n[t].use_title="不使用",n[t].isUse=1,r=n[t].name,i=n[t].id),this.couponTitle=r,this.couponId=i,this.$set(this.coupon,"coupon",!1),this.$set(this.coupon,"list",n),this.computedPrice()},ChangeIntegral:function(){this.useIntegral=!this.useIntegral,this.computedPrice()},OnDefaultAddress:function(e){this.addressInfo=e,this.address.addressId=e.id},OnChangeAddress:function(e){this.addressInfo=e,this.address.addressId=e.id,this.textareaStatus=!0,this.address.address=!1,this.computedPrice()},bindHideKeyboard:function(e){this.mark=e.detail.value},getCouponList:function(){var e=this;(0,r.getCouponsOrderPrice)(this.preOrderNo).then((function(t){e.$set(e.coupon,"list",t.data),e.openType=1}))},getaddressInfo:function(){var e=this;e.addressId?(0,i.getAddressDetail)(e.addressId).then((function(t){t.data&&(t.data.isDefault=parseInt(t.data.isDefault),e.addressInfo=t.data||{},e.addressId=t.data.id||0,e.address.addressId=t.data.id||0)})):getAddressDefault().then((function(t){t.data&&(t.data.isDefault=parseInt(t.data.isDefault),e.addressInfo=t.data||{},e.addressId=t.data.id||0,e.address.addressId=t.data.id||0)}))},payItem:function(e){var t=this,n=e;t.active=n,t.animated=!0,t.payType=t.cartArr[n].value,t.computedPrice(),setTimeout((function(){t.car()}),500)},couponTap:function(){this.coupon.coupon=!0,this.coupon.list.length||this.getCouponList()},car:function(){var e=this;e.animated=!1},onAddress:function(){var e=this;e.textareaStatus=!1,e.address.address=!0,e.pagesUrl="/pages/users/user_address_list/index?preOrderNo="+this.preOrderNo},realName:function(e){this.contacts=e.detail.value},phone:function(e){this.contactsTel=e.detail.value},payment:function(t){var n=this;(0,r.orderCreate)(t).then((function(e){n.getOrderPay(e.data.orderNo,"支付成功")})).catch((function(t){return e.hideLoading(),n.$util.Tips({title:t})}))},getOrderPay:function(t,n){var i=this,s="/pages/order_pay_status/index?order_id="+t+"&msg="+n;(0,r.wechatOrderPay)({orderNo:t,payChannel:i.payChannel,payType:i.payType,scene:"normal"===i.productType?0:1177}).then((function(r){var o=r.data.jsConfig;switch(r.data.payType){case"weixin":i.weixinPay(o,t,s);break;case"yue":return e.hideLoading(),i.$util.Tips({title:n},{tab:5,url:s+"&status=1"});case"weixinh5":e.hideLoading(),i.$util.Tips({title:"订单创建成功"},{tab:5,url:s+"&status=0"}),setTimeout((function(){location.href=o.mwebUrl+"&redirect_url="+window.location.protocol+"//"+window.location.host+s+"&status=1"}),100);break;case"alipay":break}})).catch((function(t){return e.hideLoading(),i.$util.Tips({title:t})}))},weixinPay:function(t,n,i){var o=this;e.requestPayment({timeStamp:t.timeStamp,nonceStr:t.nonceStr,package:t.packages,signType:t.signType,paySign:t.paySign,ticket:"normal"===o.productType?null:t.ticket,success:function(t){e.hideLoading(),(0,s.openOrderSubscribe)().then((function(){(0,r.wechatQueryPayResult)(n).then((function(t){return e.hideLoading(),o.orderInfoVo.bargainId||o.orderInfoVo.combinationId||o.pinkId||o.orderInfoVo.seckillId?o.$util.Tips({title:"支付成功",icon:"success"},{tab:4,url:i}):o.$util.Tips({title:"支付成功",icon:"success"},{tab:5,url:i})})).cache((function(t){return e.hideLoading(),o.$util.Tips({title:t})}))}))},fail:function(t){return e.hideLoading(),o.$util.Tips({title:"取消支付"},{tab:5,url:i+"&status=2"})},complete:function(t){if(e.hideLoading(),"requestPayment:cancel"==t.errMsg)return o.$util.Tips({title:"取消支付"},{tab:5,url:i+"&status=2"})}})},SubOrder:function(t){var n=this,r={};if(!n.payType)return n.$util.Tips({title:"请选择支付方式"});if(!n.address.addressId&&!n.shippingType)return n.$util.Tips({title:"请选择收货地址"});if(1==n.shippingType){if(""==n.contacts||""==n.contactsTel)return n.$util.Tips({title:"请填写联系人或联系人电话"});if(!/^1(3|4|5|7|8|9|6)\d{9}$/.test(n.contactsTel))return n.$util.Tips({title:"请填写正确的手机号"});if(!/^[\u4e00-\u9fa5\w]{2,16}$/.test(n.contacts))return n.$util.Tips({title:"请填写您的真实姓名"});if(0==n.storeList.length)return n.$util.Tips({title:"暂无门店,请选择其他方式"})}if(r={realName:n.contacts,phone:n.contactsTel,addressId:n.address.addressId,couponId:n.couponId,payType:n.payType,useIntegral:n.useIntegral,preOrderNo:n.preOrderNo,mark:n.mark,storeId:n.system_store.id||0,shippingType:n.$util.$h.Add(n.shippingType,1),payChannel:n.payChannel},"yue"==r.payType&&parseFloat(n.userInfo.nowMoney)<parseFloat(n.totalPrice))return n.$util.Tips({title:"余额不足！"});e.showLoading({title:"订单支付中"}),(0,s.openPaySubscribe)().then((function(){n.payment(r)}))}}};t.default=I}).call(this,n("543d")["default"])},"88bc":function(e,t,n){"use strict";var r=n("12a2"),i=n.n(r);i.a},"9e33":function(e,t,n){"use strict";n.r(t);var r=n("8431"),i=n.n(r);for(var s in r)"default"!==s&&function(e){n.d(t,e,(function(){return r[e]}))}(s);t["default"]=i.a}},[["14d9","common/runtime","common/vendor"]]]);