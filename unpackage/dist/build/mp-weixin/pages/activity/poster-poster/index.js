(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/activity/poster-poster/index"],{2015:function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=i("a519"),o=s(i("e5db")),a=i("1bab");function s(t){return t&&t.__esModule?t:{default:t}}var r={data:function(){return{parameter:{navbar:"1",return:"1",title:"拼团海报",color:!0,class:"0"},type:0,id:0,image:"",from:"",storeCombination:{},qrcodeSize:600,posterbackgd:"/static/images/canbj.png",PromotionCode:"",canvasStatus:!1,imgTop:""}},onLoad:function(e){this.from="routine";if(!e.hasOwnProperty("type")||!e.hasOwnProperty("id"))return app.Tips({title:"参数错误",icon:"none"},{tab:3,url:1});this.type=e.type,this.id=e.id,1==e.type?t.setNavigationBarTitle({title:"砍价海报"}):t.setNavigationBarTitle({title:"拼团海报"})},onShow:function(){this.getPosterInfo()},methods:{getPosterInfo:function(){var t=this;parseFloat(t.id),t.from;1==t.type||this.getCombinationPink()},getCombinationPink:function(){var e=this;(0,n.getCombinationPink)(this.id).then((function(t){e.storeCombination=t.data,e.getImageBase64(t.data.storeCombination.image)})).catch((function(i){e.$util.Tips({title:i}),t.redirectTo({success:function(){},fail:function(){t.navigateTo({url:"/pages/index/index"})}})}))},getImageBase64:function(t){var e=this;(0,a.imageBase64)({url:t}).then((function(t){e.imgTop=t.data.code}))},make:function(t){var e=this,i=location.protocol+"//"+window.location.host+"/pages/activity/goods_combination_status/index?id="+this.id+"&spread="+t;o.default.make({canvasId:"qrcode",text:i,size:this.qrcodeSize,margin:10,success:function(t){e.PromotionCode=t;var i=[e.posterbackgd,e.imgTop,e.PromotionCode],n=e.storeCombination.storeCombination.title,o=e.storeCombination.storeCombination.price,a=e.storeCombination.storeCombination.people,s=e.storeCombination.storeCombination.otPrice,r=e.storeCombination.count;setTimeout((function(){e.PosterCanvas(i,n,o,a,s,r)}),300)},complete:function(){},fail:function(t){e.$util.Tips({title:"海报二维码生成失败！"})}})},PosterCanvas:function(e,i,n,o,a,s){t.showLoading({title:"海报生成中",mask:!0});var r=t.createCanvasContext("firstCanvas");r.clearRect(0,0,0,0);var c=this;t.getImageInfo({src:e[0],success:function(l){r.drawImage(e[0],0,0,750,1190),r.setFontSize(36),r.setTextAlign("center"),r.setFillStyle("#282828");var u=20,f=i,d="",m="",g=f.length;g>2*u?(f=f.slice(0,2*u-4)+"......",d=f.slice(0,u-1),m=f.slice(u-1,g)):g>u?(d=f.slice(0,u-1),m=f.slice(u-1,g)):(d=f,m=""),r.fillText(d,375,60),r.fillText(m,375,100),r.drawImage(e[1],150,350,450,450),r.save(),r.drawImage(e[2],300,950,140,140),r.restore(),r.setFontSize(72),r.setFillStyle("#fc4141"),r.fillText(n,250,210),r.setFontSize(32),r.setFillStyle("#FFFFFF"),r.fillText(o+"人团",538,198),r.setFontSize(26),r.setFillStyle("#3F3F3F"),r.setTextAlign("center"),r.fillText("原价：￥"+a+"   还差 "+s+"人 拼团成功",375,275),r.draw(!0,(function(){t.canvasToTempFilePath({destWidth:750,destHeight:1190,canvasId:"firstCanvas",fileType:"jpg",success:function(e){t.hideLoading(),c.imagePath=e.tempFilePath,c.canvasStatus=!0}})}))},fail:function(e){t.hideLoading(),c.$util.Tips({title:"无法获取图片信息"})}})},showImage:function(){var e=this.image.split(",");t.previewImage({urls:e,longPressActions:{itemList:["发送给朋友","保存图片","收藏"],success:function(t){console.log("选中了第"+(t.tapIndex+1)+"个按钮,第"+(t.index+1)+"张图片")},fail:function(t){console.log(t.errMsg)}}})}}};e.default=r}).call(this,i("543d")["default"])},2393:function(t,e,i){"use strict";(function(t){i("f524");n(i("66fd"));var e=n(i("f4c5"));function n(t){return t&&t.__esModule?t:{default:t}}wx.__webpack_require_UNI_MP_PLUGIN__=i,t(e.default)}).call(this,i("543d")["createPage"])},2518:function(t,e,i){"use strict";var n;i.d(e,"b",(function(){return o})),i.d(e,"c",(function(){return a})),i.d(e,"a",(function(){return n}));var o=function(){var t=this,e=t.$createElement;t._self._c},a=[]},cdfc:function(t,e,i){"use strict";var n=i("d4b3"),o=i.n(n);o.a},d4b3:function(t,e,i){},f451:function(t,e,i){"use strict";i.r(e);var n=i("2015"),o=i.n(n);for(var a in n)"default"!==a&&function(t){i.d(e,t,(function(){return n[t]}))}(a);e["default"]=o.a},f4c5:function(t,e,i){"use strict";i.r(e);var n=i("2518"),o=i("f451");for(var a in o)"default"!==a&&function(t){i.d(e,t,(function(){return o[t]}))}(a);i("cdfc");var s,r=i("f0c5"),c=Object(r["a"])(o["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],s);e["default"]=c.exports}},[["2393","common/runtime","common/vendor"]]]);