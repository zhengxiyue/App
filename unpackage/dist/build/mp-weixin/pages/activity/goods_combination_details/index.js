(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/activity/goods_combination_details/index"],{"21c3":function(t,e,i){"use strict";i.d(e,"b",(function(){return n})),i.d(e,"c",(function(){return r})),i.d(e,"a",(function(){return o}));var o={jyfParser:function(){return Promise.all([i.e("common/vendor"),i.e("components/jyf-parser/jyf-parser")]).then(i.bind(null,"58d3"))},cusPreviewImg:function(){return i.e("components/cus-previewImg/cus-previewImg").then(i.bind(null,"a2c7"))}},n=function(){var t=this,e=t.$createElement,i=(t._self._c,parseFloat(t.storeInfo.sales)),o=parseFloat(t.storeInfo.ficti),n=t.skuArr.length>1?t.skuArr.slice(0,4):null,r=parseFloat(t.pinkOkSum);t._isMounted||(t.e0=function(e){t.H5ShareBox=!1}),t.$mp.data=Object.assign({},{$root:{m0:i,m1:o,l0:n,m2:r}})},r=[]},6593:function(t,e,i){"use strict";(function(t){i("f524");o(i("66fd"));var e=o(i("ea81"));function o(t){return t&&t.__esModule?t:{default:t}}wx.__webpack_require_UNI_MP_PLUGIN__=i,t(e.default)}).call(this,i("543d")["createPage"])},"90e5":function(t,e,i){"use strict";var o=i("9860"),n=i.n(o);n.a},9860:function(t,e,i){},d315:function(t,e,i){"use strict";i.r(e);var o=i("e48a"),n=i.n(o);for(var r in o)"default"!==r&&function(t){i.d(e,t,(function(){return o[t]}))}(r);e["default"]=n.a},e48a:function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=p(i("e5db")),n=i("26cb"),r=i("b1ec"),s=i("98f4"),a=i("a30d"),u=i("8a48"),c=i("a519"),l=i("b07f"),h=i("1bab"),d=i("cc12");function p(t){return t&&t.__esModule?t:{default:t}}function f(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var m=getApp(),g=function(){Promise.all([i.e("common/vendor"),i.e("components/Authorize")]).then(function(){return resolve(i("5da7"))}.bind(null,i)).catch(i.oe)},b=function(){Promise.all([i.e("common/vendor"),i.e("components/productConSwiper/index")]).then(function(){return resolve(i("ceec"))}.bind(null,i)).catch(i.oe)},v=function(){Promise.all([i.e("common/vendor"),i.e("components/jyf-parser/jyf-parser")]).then(function(){return resolve(i("58d3"))}.bind(null,i)).catch(i.oe)},S=function(){i.e("components/home/index").then(function(){return resolve(i("40e3"))}.bind(null,i)).catch(i.oe)},$=function(){i.e("components/productWindow/index").then(function(){return resolve(i("3076"))}.bind(null,i)).catch(i.oe)},I=function(){i.e("components/userEvaluation/index").then(function(){return resolve(i("90a6"))}.bind(null,i)).catch(i.oe)},_=function(){i.e("components/countDown/index").then(function(){return resolve(i("853c"))}.bind(null,i)).catch(i.oe)},w=function(){i.e("components/shareRedPackets/index").then(function(){return resolve(i("1892"))}.bind(null,i)).catch(i.oe)},C=function(){i.e("components/cus-previewImg/cus-previewImg").then(function(){return resolve(i("a2c7"))}.bind(null,i)).catch(i.oe)},P={components:{shareRedPackets:w,productConSwiper:b,authorize:g,"jyf-parser":v,home:S,cusPreviewImg:C,"product-window":$,userEvaluation:I,countDown:_},computed:(0,n.mapGetters)({isLogin:"isLogin",userData:"userInfo",uid:"uid",chatUrl:"chatUrl"}),data:function(){var t;return t={showSkeleton:!0,isNodes:0,bgColor:{bgColor:"",Color:"#999999",isDay:!0},userCollect:!1,dataShow:0,navH:"",id:0,userInfo:{},itemNew:[],indicatorDots:!1,circular:!0,autoplay:!0,interval:3e3,duration:500,attribute:{cartAttr:!1,productAttr:[],productSelect:{}},productValue:[],isOpen:!1,attr:"请选择",attrValue:"",AllIndex:2,maxAllIndex:0,replyChance:"",limitNum:1,timeer:null,iSplus:!1},f(t,"navH",""),f(t,"navList",["商品","评价","详情"]),f(t,"opacity",0),f(t,"scrollY",0),f(t,"topArr",[]),f(t,"toView",""),f(t,"height",0),f(t,"heightArr",[]),f(t,"lock",!1),f(t,"scrollTop",0),f(t,"storeInfo",{}),f(t,"pinkOkSum",0),f(t,"pink",[]),f(t,"replyCount",0),f(t,"reply",[]),f(t,"imgUrls",[]),f(t,"sharePacket",{isState:!0}),f(t,"tagStyle",{img:"width:100%;display:block;",table:"width:100%",video:"width:100%"}),f(t,"posters",!1),f(t,"weixinStatus",!1),f(t,"posterImageStatus",!1),f(t,"canvasStatus",!1),f(t,"storeImage",""),f(t,"PromotionCode",""),f(t,"posterImage",""),f(t,"posterbackgd","/static/images/posterbackgd.png"),f(t,"navActive",0),f(t,"actionSheetHidden",!1),f(t,"attrTxt",""),f(t,"cart_num",""),f(t,"isAuto",!1),f(t,"isShowAuth",!1),f(t,"AllIndexDefault",0),f(t,"imgTop",""),f(t,"qrcodeSize",600),f(t,"H5ShareBox",!1),f(t,"onceNum",0),f(t,"errT",""),f(t,"returnShow",!0),f(t,"homeTop",20),f(t,"navbarRight",0),f(t,"theme",m.globalData.theme),f(t,"skuArr",[]),f(t,"currentPage",!1),f(t,"selectSku",{}),f(t,"selectNavList",[{name:"首页",icon:"icon-shouye8",url:"/pages/index/index",after:"dialog_after"},{name:"搜索",icon:"icon-sousuo6",url:"/pages/goods_search/index",after:"dialog_after"},{name:"购物车",icon:"icon-gouwuche7",url:"/pages/order_addcart/order_addcart",after:"dialog_after"},{name:"我的收藏",icon:"icon-shoucang3",url:"/pages/users/user_goods_collection/index",after:"dialog_after"},{name:"个人中心",icon:"icon-gerenzhongxin1",url:"/pages/user/index"}]),f(t,"chatConfig",{consumer_hotline:"",telephone_service_switch:"false"}),f(t,"masterStatus",""),t},watch:{isLogin:{handler:function(t,e){t&&this.combinationDetail()},deep:!0}},onLoad:function(e){var i=this,o=this;setTimeout((function(){o.isNodes++}),500),this.$store.commit("PRODUCT_TYPE","normal");getCurrentPages();if(o.$set(o,"chatConfig",o.$Cache.getItem("chatConfig")),this.$nextTick((function(){var e=t.getMenuButtonBoundingClientRect(),o=t.createSelectorQuery().in(i);o.select("#home").boundingClientRect((function(t){i.homeTop=2*e.top+e.height-t.height})).exec()})),this.navH=m.globalData.navHeight,setTimeout((function(){e.spread&&(m.globalData.spread=e.spread,(0,d.spread)(e.spread).then((function(t){})))}),2e3),o.$set(o,"theme",o.$Cache.get("theme")),t.getSystemInfo({success:function(t){o.height=t.windowHeight}}),e.hasOwnProperty("id")||e.scene){if(e.scene){var n=this.$util.getUrlParams(decodeURIComponent(e.scene)),s=this.$util.formatMpQrCodeData(n);m.globalData.spread=s.spread,this.id=s.id,setTimeout((function(){(0,d.spread)(s.spread).then((function(t){})).catch((function(t){}))}),2e3)}else this.id=e.id;this.isLogin?this.combinationDetail():(this.$Cache.set("login_back_url","/pages/activity/goods_combination_details/index?id=".concat(e.id,"&spread=").concat(e.pid?e.pid:0)),(0,u.toLogin)())}else try{var a=t.getStorageSync("comGoodsId");""!=a&&(this.id=a,this.combinationDetail())}catch(c){t.showToast({title:"参数错误",icon:"none",duration:1e3,mask:!0})}(0,r.silenceBindingSpread)()},methods:{getProductReplyCount:function(){var t=this;(0,l.getReplyConfig)(t.storeInfo.productId).then((function(e){t.$set(t,"replyChance",100*e.data.replyChance),t.$set(t,"replyCount",e.data.sumCount)}))},getProductReplyList:function(){var t=this;(0,l.getReplyProduct)(this.storeInfo.productId).then((function(e){t.reply=e.data.productReply?[e.data.productReply]:[]}))},kefuClick:function(){"true"===this.chatConfig.telephone_service_switch?t.makePhoneCall({phoneNumber:this.chatConfig.consumer_hotline}):location.href=this.chatUrl},closePosters:function(){this.posters=!1},closeChange:function(){this.$set(this.sharePacket,"isState",!0)},showAll:function(){this.AllIndexDefault=this.AllIndex,this.AllIndex=this.pink.length},hideAll:function(){this.AllIndex=this.AllIndexDefault},authColse:function(t){this.isShowAuth=t},iptCartNum:function(t){t>this.onceNum?(this.$util.Tips({title:"该商品每次限购".concat(this.onceNum).concat(this.storeInfo.unitName)}),this.$set(this.attribute.productSelect,"cart_num",this.onceNum),this.$set(this,"cart_num",this.onceNum)):(this.$set(this.attribute.productSelect,"cart_num",t),this.$set(this,"cart_num",t))},returns:function(){t.navigateBack()},showNav:function(){this.currentPage=!this.currentPage},combinationDetail:function(){var e=this,i=e.id;(0,c.getCombinationDetail)(i).then((function(i){for(var o in e.dataShow=1,t.setNavigationBarTitle({title:i.data.storeCombination.storeName.substring(0,16)}),e.masterStatus=i.data.masterStatus,e.storeInfo=i.data.storeCombination,e.getProductReplyList(),e.getProductReplyCount(),e.imgUrls=JSON.parse(i.data.storeCombination.sliderImage),e.attribute.productSelect.num=i.data.storeCombination.onceNum,e.userCollect=i.data.userCollect,e.pink=i.data.pinkList||[],e.itemNew=i.data.pinkOkList||[],e.pinkOkSum=i.data.pinkOkSum,e.attribute.productAttr=i.data.productAttr||[],e.productValue=i.data.productValue,i.data.productValue){var n=i.data.productValue[o];e.skuArr.push(n)}e.$set(e,"selectSku",e.skuArr[0]),e.onceNum=i.data.storeCombination.onceNum,e.getQrcode(),e.imgTop=i.data.storeCombination.image,e.downloadFilestoreImage();var r=i.data.productAttr.map((function(t){return{attrName:t.attrName,attrValues:t.attrValues.split(","),id:t.id,isDel:t.isDel,productId:t.productId,type:t.type}}));e.$set(e.attribute,"productAttr",r),e.DefaultSelect(),setTimeout((function(){e.infoScroll()}),500),setTimeout((function(){e.showSkeleton=!1}),1e3)})).catch((function(t){e.$util.Tips({title:t},{tab:3})}))},DefaultSelect:function(){var t=this,e=t.attribute.productAttr,i=[];e.forEach((function(t){i.push(t.attrValues[0])}));for(var o=0;o<i.length;o++)t.$set(e[o],"index",i[o]);var n=t.productValue[i.join(",")];if(n&&e.length)t.$set(t.attribute.productSelect,"storeName",t.storeInfo.storeName),t.$set(t.attribute.productSelect,"image",n.image),t.$set(t.attribute.productSelect,"price",n.price),t.$set(t.attribute.productSelect,"unique",n.id),t.$set(t.attribute.productSelect,"quota",n.quota),t.$set(t.attribute.productSelect,"quotaShow",n.quotaShow),t.$set(t.attribute.productSelect,"cart_num",1),this.$set(this,"attrValue",i.join(",")),this.$set(this,"attrTxt","已选择");else if(!n&&e.length)t.$set(t.attribute.productSelect,"storeName",t.storeInfo.storeName),t.$set(t.attribute.productSelect,"image",t.storeInfo.image),t.$set(t.attribute.productSelect,"price",t.storeInfo.price),t.$set(t.attribute.productSelect,"quota",0),t.$set(t.attribute.productSelect,"quotaShow",0),t.$set(t.attribute.productSelect,"unique",""),t.$set(t.attribute.productSelect,"cart_num",0),t.$set(t,"attrValue",""),t.$set(t,"attrTxt","请选择");else if(!n&&!e.length){t.$set(t.attribute.productSelect,"storeName",t.storeInfo.storeName),t.$set(t.attribute.productSelect,"image",t.storeInfo.image),t.$set(t.attribute.productSelect,"price",t.storeInfo.price),t.$set(t.attribute.productSelect,"quota",t.storeInfo.quota);var r=t.skuArr[0].id;t.$set(t.attribute.productSelect,"unique",r),t.$set(t.attribute.productSelect,"cart_num",1),t.$set(t,"attrValue",""),t.$set(t,"attrTxt","请选择")}},infoScroll:function(){for(var e=this,i=[],o=[],n=0;n<e.navList.length;n++){var r=t.createSelectorQuery().in(this),s="#past"+n;r.select(s).boundingClientRect(),r.exec((function(t){var n=t[0].top,r=t[0].height;i.push(n),o.push(r),e.topArr=i,e.heightArr=o}))}},onLoadFun:function(t){this.userInfo=t,m.globalData.openPages="/pages/activity/goods_combination_details/index?id="+this.id+"&spread="+t.uid,this.combinationDetail()},selecAttr:function(){this.attribute.cartAttr=!0},onMyEvent:function(){this.$set(this.attribute,"cartAttr",!1),this.$set(this,"isOpen",!1)},ChangeCartNum:function(t){var e=this.productValue[this.attrValue];if(this.buyNum===e.quota)return this.$util.Tips({title:"您已超出当前商品每人限购数量，请浏览其他商品"});if(this.cart_num&&(e.cart_num=this.cart_num,this.attribute.productSelect.cart_num=this.cart_num),void 0!==e||this.attribute.productAttr.length||(e=this.attribute.productSelect),void 0!==e){e.quota_show;var i=e.quota||0,o=this.attribute.productSelect,n=this.storeInfo.onceNum||0;if(void 0==e.cart_num&&(e.cart_num=1),t){if(o.cart_num===this.onceNum)return this.$util.Tips({title:"该商品每次限购".concat(this.onceNum).concat(this.storeInfo.unitName)});o.cart_num++;var r=[];r.push(n),r.push(i);var s=Math.min.apply(null,r);o.cart_num>=s&&(this.$set(this.attribute.productSelect,"cart_num",s||1),this.$set(this,"cart_num",s||1)),this.$set(this,"cart_num",o.cart_num),this.$set(this.attribute.productSelect,"cart_num",o.cart_num)}else o.cart_num--,o.cart_num<1&&(this.$set(this.attribute.productSelect,"cart_num",1),this.$set(this,"cart_num",1)),this.$set(this,"cart_num",o.cart_num),this.$set(this.attribute.productSelect,"cart_num",o.cart_num)}},attrVal:function(t){this.attribute.productAttr[t.indexw].index=this.attribute.productAttr[t.indexw].attrValues[t.indexn]},ChangeAttr:function(t){this.$set(this,"cart_num",1);var e=this.productValue[t];this.$set(this,"selectSku",e),e?(this.$set(this.attribute.productSelect,"image",e.image),this.$set(this.attribute.productSelect,"price",e.price),this.$set(this.attribute.productSelect,"unique",e.id),this.$set(this.attribute.productSelect,"cart_num",1),this.$set(this.attribute.productSelect,"quota",e.quota),this.$set(this.attribute.productSelect,"quotaShow",e.quotaShow),this.$set(this,"attrValue",t),this.attrTxt="已选择"):(this.$set(this.attribute.productSelect,"image",this.storeInfo.image),this.$set(this.attribute.productSelect,"price",this.storeInfo.price),this.$set(this.attribute.productSelect,"unique",""),this.$set(this.attribute.productSelect,"cart_num",0),this.$set(this.attribute.productSelect,"quota",0),this.$set(this.attribute.productSelect,"quotaShow",0),this.$set(this,"attrValue",""),this.attrTxt="已选择")},goProduct:function(){t.navigateTo({url:"/pages/goods_details/index?id="+this.storeInfo.productId})},goCat:function(){var t=this,e=this.productValue[this.attrValue];if(this.isOpen?this.attribute.cartAttr=!0:this.attribute.cartAttr=!this.attribute.cartAttr,!0===this.attribute.cartAttr&&0==this.isOpen)return this.isOpen=!0;if(this.attribute.productAttr.length&&void 0===e&&1==this.isOpen)return t.$util.Tips({title:"请选择属性"});t.storeInfo.productId,parseFloat(t.id),t.cart_num?this.cart_num:this.attribute.productSelect.cart_num,void 0!==e&&e.id;this.$Order.getPreOrder("buyNow",[{attrValueId:parseFloat(this.attribute.productSelect.unique),combinationId:parseFloat(this.id),productNum:parseFloat(this.cart_num?this.cart_num:this.attribute.productSelect.cart_num),productId:parseFloat(this.storeInfo.productId)}])},setCollect:function(){var t=this;this.userCollect?(0,l.collectDel)(this.storeInfo.productId).then((function(e){t.userCollect=!t.userCollect})):(0,l.collectAdd)(this.storeInfo.productId).then((function(e){t.userCollect=!t.userCollect}))},listenerActionSheet:function(){0==this.isLogin?(0,u.toLogin)():(this.goPoster(),this.posters=!0)},listenerActionClose:function(){this.canvasStatus=!1},posterImageClose:function(){this.canvasStatus=!1,this.posters=!1},setDomain:function(t){return t=t?t.toString():"",t.indexOf("https://")>-1?t:t.replace("http://","https://")},downloadFilestoreImage:function(){var e=this;t.downloadFile({url:e.setDomain(e.storeInfo.image),success:function(t){e.storeImage=t.tempFilePath},fail:function(){return e.$util.Tips({title:""})}})},downloadFileAppCode:function(){var e=this;t.downloadFile({url:e.setDomain(e.storeInfo.code_base),success:function(t){e.PromotionCode=t.tempFilePath},fail:function(){return e.$util.Tips({title:""})}})},downloadFilePromotionCode:function(e){var i=this;scombinationCode(i.id).then((function(o){t.downloadFile({url:i.setDomain(o.data.code),success:function(t){i.$set(i,"isDown",!1),"function"==typeof e?e&&e(t.tempFilePath):i.$set(i,"PromotionCode",t.tempFilePath)},fail:function(){i.$set(i,"isDown",!1),i.$set(i,"PromotionCode","")}})})).catch((function(t){i.$set(i,"isDown",!1),i.$set(i,"PromotionCode","")}))},getImageBase64:function(t){var e=this;(0,h.imageBase64)({url:t}).then((function(t){e.imgTop=t.data.code}))},goFriend:function(){this.posters=!1},goPoster:function(){var e=this;t.showLoading({title:"海报生成中",mask:!0}),e.posters=!1;var i="";if(!e.PromotionCode)return t.hideLoading(),void e.$util.Tips({title:e.errT});t.downloadFile({url:e.imgTop,success:function(o){i=o.tempFilePath;var n=[e.posterbackgd,i,e.PromotionCode],r=e.storeInfo.storeName,s=e.storeInfo.price;setTimeout((function(){e.$util.PosterCanvas(n,r,s,e.storeInfo.otPrice,(function(i){e.posterImage=i,e.canvasStatus=!0,t.hideLoading()}))}),500)}})},getpreviewImage:function(){if(this.posterImage){var e=[];e.push(this.posterImage),t.previewImage({urls:e,current:this.posterImage})}else this.$util.Tips({title:"您的海报尚未生成"})},getQrcode:function(){var t=this,e={pid:t.uid,id:t.id,path:"pages/activity/goods_combination_details/index"};(0,a.getQrcode)(e).then((function(e){(0,s.base64src)(e.data.code,Date.now(),(function(e){t.PromotionCode=e}))})).catch((function(e){t.errT=e}))},make:function(){var t=this,e=location.href.split("?")[0]+"?id="+this.id+"&spread="+this.uid;o.default.make({canvasId:"qrcode",text:e,size:this.qrcodeSize,margin:10,success:function(e){t.PromotionCode=e},complete:function(t){},fail:function(e){t.$util.Tips({title:"海报二维码生成失败！"})}})},savePosterPath:function(){var e=this;t.getSetting({success:function(i){i.authSetting["scope.writePhotosAlbum"]?t.saveImageToPhotosAlbum({filePath:e.posterImage,success:function(t){e.posterImageClose(),e.$util.Tips({title:"保存成功",icon:"success"})},fail:function(t){e.$util.Tips({title:"保存失败"})}}):t.authorize({scope:"scope.writePhotosAlbum",success:function(){t.saveImageToPhotosAlbum({filePath:e.posterImage,success:function(t){e.posterImageClose(),e.$util.Tips({title:"保存成功",icon:"success"})},fail:function(t){e.$util.Tips({title:"保存失败"})}})}})}})},setShareInfoStatus:function(){var t=this.storeInfo,e=location.href;if(this.$wechat.isWeixin()){e=-1===e.indexOf("?")?e+"?spread="+this.uid:e+"&spread="+this.uid;var i={desc:t.storeInfo,title:t.storeName,link:e,imgUrl:t.image};this.$wechat.wechatEvevt(["updateAppMessageShareData","updateTimelineShareData"],i)}},scroll:function(t){var e=this,i=t.detail.scrollTop,o=i/500;if(o=o>1?1:o,e.opacity=o,e.scrollY=i,e.lock)e.lock=!1;else for(var n=0;n<e.topArr.length;n++)if(i<e.topArr[n]-m.globalData.navHeight/2+e.heightArr[n]){e.navActive=n;break}},tap:function(t,e){var i=t.id,o=(e=e,this);this.toView=i,this.navActive=e,this.lock=!0,this.scrollTop=e>0?o.topArr[e]-m.globalData.navHeight/2:o.topArr[e]},hideNav:function(){this.currentPage=!1},linkPage:function(e){"/pages/index/index"==e||"/pages/order_addcart/order_addcart"==e||"/pages/user/index"==e?t.switchTab({url:e}):t.navigateTo({url:e}),this.currentPage=!1},showImg:function(t){this.$refs.cusPreviewImg.open(this.selectSku.suk)},changeSwitch:function(t){var e=this,i=this.skuArr[t];this.$set(this,"selectSku",i);var o=i.suk.split(",");o.forEach((function(t,i){e.$set(e.attribute.productAttr[i],"index",o[i])})),i&&(this.$set(this.attribute.productSelect,"image",i.image),this.$set(this.attribute.productSelect,"price",i.price),this.$set(this.attribute.productSelect,"stock",i.stock),this.$set(this.attribute.productSelect,"unique",i.id),this.$set(this.attribute.productSelect,"quota",i.quota),this.$set(this.attribute.productSelect,"quotaShow",i.quotaShow),this.$set(this.attribute.productSelect,"cart_num",1),this.$set(this,"attrTxt","已选择"),this.$set(this,"attrValue",i.suk))}},onShareAppMessage:function(){var t=this;return{title:t.storeInfo.storeName,path:m.globalData.openPages,imageUrl:t.storeInfo.image}}};e.default=P}).call(this,i("543d")["default"])},ea81:function(t,e,i){"use strict";i.r(e);var o=i("21c3"),n=i("d315");for(var r in n)"default"!==r&&function(t){i.d(e,t,(function(){return n[t]}))}(r);i("90e5");var s,a=i("f0c5"),u=Object(a["a"])(n["default"],o["b"],o["c"],!1,null,"7d4b7290",null,!1,o["a"],s);e["default"]=u.exports}},[["6593","common/runtime","common/vendor"]]]);